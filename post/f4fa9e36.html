<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="baidu-site-verification" content="WIIeufYjj6"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://winddoing.github.io").hostname,root:"/",scheme:"Mist",version:"7.7.0",exturl:!1,sidebar:{position:"right",width:300,display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"flat"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!0,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"输入关键词",hits_empty:"没有找到与「${query}」相关的内容",hits_stats:"${hits} 条相关记录，共耗时 ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="RDMA(Remote Direct Memory Access)全称远程直接数据存取，就是为了解决网络传输中服务器端数据处理的延迟而产生的。RDMA通过网络把资料直接传入计算机的存储区，将数据从一个系统快速移动到远程系统存储器中，而不对操作系统造成任何影响，这样就不需要用到多少计算机的处理功能。它消除了外部存储器复制和上下文切换的开销，因而能解放内存带宽和CPU周期用于改进应用系统性能。"><meta name="keywords" content="网络,rdma"><meta property="og:type" content="article"><meta property="og:title" content="RDMA网络简介"><meta property="og:url" content="https://winddoing.github.io/post/f4fa9e36.html"><meta property="og:site_name" content="Winddoing&#39;s Notes"><meta property="og:description" content="RDMA(Remote Direct Memory Access)全称远程直接数据存取，就是为了解决网络传输中服务器端数据处理的延迟而产生的。RDMA通过网络把资料直接传入计算机的存储区，将数据从一个系统快速移动到远程系统存储器中，而不对操作系统造成任何影响，这样就不需要用到多少计算机的处理功能。它消除了外部存储器复制和上下文切换的开销，因而能解放内存带宽和CPU周期用于改进应用系统性能。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://winddoing.github.io/images/2021/05/netdata_rdma_ib.png"><meta property="og:updated_time" content="2021-07-14T09:13:21.853Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="RDMA网络简介"><meta name="twitter:description" content="RDMA(Remote Direct Memory Access)全称远程直接数据存取，就是为了解决网络传输中服务器端数据处理的延迟而产生的。RDMA通过网络把资料直接传入计算机的存储区，将数据从一个系统快速移动到远程系统存储器中，而不对操作系统造成任何影响，这样就不需要用到多少计算机的处理功能。它消除了外部存储器复制和上下文切换的开销，因而能解放内存带宽和CPU周期用于改进应用系统性能。"><meta name="twitter:image" content="https://winddoing.github.io/images/2021/05/netdata_rdma_ib.png"><link rel="canonical" href="https://winddoing.github.io/post/f4fa9e36.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css"><style>#needsharebutton-postbottom{cursor:pointer;height:26px;margin-top:10px;position:relative}#needsharebutton-postbottom .btn{border:1px solid $btn-default-border-color;border-radius:3px;display:initial;padding:1px 4px}</style><title>RDMA网络简介 | Winddoing's Notes</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?38fa95924670925239ef842cb0c8722b";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Winddoing's Notes</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Follow Excellent, Success will Chase you</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://winddoing.github.io/post/f4fa9e36.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/Winddoing.jpg"><meta itemprop="name" content="Winddoing"><meta itemprop="description" content="失败缘于忽视细处，成功始于重视小事。"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Winddoing's Notes"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> RDMA网络简介</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-05-28 14:27:00" itemprop="dateCreated datePublished" datetime="2021-05-28T14:27:00+08:00">2021-05-28</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/网络/" itemprop="url" rel="index"><span itemprop="name">网络</span></a></span></span><span id="/post/f4fa9e36.html" class="post-meta-item leancloud_visitors" data-flag-title="RDMA网络简介" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>13k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>12 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p><code>RDMA</code>(Remote Direct Memory Access)全称<code>远程直接数据存取</code>，就是为了解决网络传输中服务器端数据处理的延迟而产生的。RDMA通过网络把资料直接传入计算机的存储区，将数据从一个系统快速移动到远程系统存储器中，而不对操作系统造成任何影响，这样就不需要用到多少计算机的处理功能。它消除了外部存储器复制和上下文切换的开销，因而能解放内存带宽和CPU周期用于改进应用系统性能。</p><a id="more"></a><h2 id="驱动下载"><a href="#驱动下载" class="headerlink" title="驱动下载"></a>驱动下载</h2><blockquote><p><a href="https://www.mellanox.com/products/infiniband-drivers/linux/mlnx_ofed" target="_blank" rel="noopener">https://www.mellanox.com/products/infiniband-drivers/linux/mlnx_ofed</a></p></blockquote><p>判断驱动是否安装成功：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ibdev2netdev</span></span><br><span class="line">mlx5_0 port 1 ==&gt; ens2f0 (Up)   #表示该网口插了网线</span><br><span class="line">mlx5_1 port 1 ==&gt; ens2f1 (Down) #表示该网口没有插网线</span><br></pre></td></tr></table></figure><p></p><blockquote><p><code>ibdev2netdev</code>命令输出以上类似信息表明网卡驱动安装成功</p></blockquote><h2 id="吞吐量测试"><a href="#吞吐量测试" class="headerlink" title="吞吐量测试"></a>吞吐量测试</h2><h3 id="写吞吐量"><a href="#写吞吐量" class="headerlink" title="写吞吐量"></a>写吞吐量</h3><p>在RDMA驱动安装时会安装一些RDMA工具，可以使用<code>ib_send_bw</code>测试写吞吐量</p><p>服务器A（server）：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ib_write_bw -a -d mlx5_0</span><br></pre></td></tr></table></figure><p></p><p>服务器B（client）：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ib_write_bw -a -d mlx5_0 192.168.2.1(server端ip)</span><br></pre></td></tr></table></figure><p></p><h3 id="读吞吐量"><a href="#读吞吐量" class="headerlink" title="读吞吐量"></a>读吞吐量</h3><p>读吞吐量的测试与写吞吐量测试相同，只是使用命令换为<code>ib_read_bw</code></p><h2 id="延时测试"><a href="#延时测试" class="headerlink" title="延时测试"></a>延时测试</h2><p>测试同样分为读写，测试工具为<code>ib_read_lat</code>、<code>ib_write_lat</code></p><ul><li><a href="https://community.mellanox.com/s/article/performance-tuning-for-mellanox-adapters" target="_blank" rel="noopener">Performance Tuning for Mellanox Adapters</a></li></ul><h2 id="带宽统计"><a href="#带宽统计" class="headerlink" title="带宽统计"></a>带宽统计</h2><p>在使用RDMA时，发送和接收的数据带宽可以在app中自己进行收集，这样我们的程序发送和接收的数据量会很清楚。<br>如果想知道当前RDMA网卡所发送和接收的带宽可以通过sysfs下的相关节点获取。</p><ul><li>发送数据量（byte）：<code>/sys/class/infiniband/mlx5_0/ports/1/counters/port_xmit_data</code></li><li>接收数据量（byte）：<code>/sys/class/infiniband/mlx5_0/ports/1/counters/port_rcv_data</code></li></ul><p><strong>注</strong>：<code>port_xmit_data</code>和<code>port_rcv_data</code>的数值是实际的1/4,因此实际的带宽是在其基础之上乘以<code>4</code>，应该是为了防止数据溢出</p><blockquote><p>port_xmit_data: (RO) Total number of data octets, divided by 4 (lanes), transmitted on all VLs. This is 64 bit counter<br>port_rcv_data: (RO) Total number of data octets, divided by 4 (lanes), received on all VLs. This is 64 bit counter.</p><blockquote><p>来自： <code>Documentation/ABI/stable/sysfs-class-infiniband</code></p></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pma_cnt_ext-&gt;port_xmit_data =</span><br><span class="line">    cpu_to_be64(MLX5_SUM_CNT(out, transmitted_ib_unicast.octets,</span><br><span class="line">                 transmitted_ib_multicast.octets) &gt;&gt; <span class="number">2</span>);</span><br><span class="line">pma_cnt_ext-&gt;port_rcv_data =</span><br><span class="line">    cpu_to_be64(MLX5_SUM_CNT(out, received_ib_unicast.octets,</span><br><span class="line">                 received_ib_multicast.octets) &gt;&gt; <span class="number">2</span>);</span><br></pre></td></tr></table></figure><blockquote><p>file: drivers/infiniband/hw/mlx5/mad.c</p></blockquote><h2 id="网络联通性测试"><a href="#网络联通性测试" class="headerlink" title="网络联通性测试"></a>网络联通性测试</h2><p>由于当前网卡只支持<code>Ethernet</code>模式，因此只能使用<code>ibv_rc_pingpong</code>进行ping测试。</p><ul><li><a href="https://community.mellanox.com/s/article/RoCE-Debug-Flow-for-Linux" target="_blank" rel="noopener">https://community.mellanox.com/s/article/RoCE-Debug-Flow-for-Linux</a></li></ul><h3 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ibdev2netdev</span></span><br><span class="line">mlx4_0 port 1 ==&gt; enp1s0 (Down)</span><br><span class="line">mlx5_0 port 1 ==&gt; ens2f0 (Up)</span><br><span class="line">mlx5_1 port 1 ==&gt; ens2f1 (Up)</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ibv_rc_pingpong -d mlx5_0 -g 0</span></span><br><span class="line">  local address:  LID 0x0000, QPN 0x00011a, PSN 0xd775ee, GID fe80::e42:a1ff:fe41:2d36</span><br><span class="line">  remote address: LID 0x0000, QPN 0x0009df, PSN 0xa7f02f, GID fe80::1e34:daff:fe79:c0d</span><br><span class="line">8192000 bytes in 0.01 seconds = 5126.01 Mbit/sec</span><br><span class="line">1000 iters in 0.01 seconds = 12.78 usec/iter</span><br></pre></td></tr></table></figure><h3 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ibdev2netdev</span></span><br><span class="line">mlx5_0 port 1 ==&gt; p5p1 (Down)</span><br><span class="line">mlx5_1 port 1 ==&gt; p5p2 (Up)</span><br><span class="line">mlx5_2 port 1 ==&gt; p4p1 (Down)</span><br><span class="line">mlx5_3 port 1 ==&gt; p4p2 (Down)</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ibv_rc_pingpong -d mlx5_1 -g 0 192.168.2.4</span></span><br><span class="line">  local address:  LID 0x0000, QPN 0x0009df, PSN 0xa7f02f, GID fe80::1e34:daff:fe79:c0d</span><br><span class="line">  remote address: LID 0x0000, QPN 0x00011a, PSN 0xd775ee, GID fe80::e42:a1ff:fe41:2d36</span><br><span class="line">8192000 bytes in 0.01 seconds = 5376.21 Mbit/sec</span><br><span class="line">1000 iters in 0.01 seconds = 12.19 usec/iter</span><br></pre></td></tr></table></figure><h2 id="mlx5计数器和状态参数"><a href="#mlx5计数器和状态参数" class="headerlink" title="mlx5计数器和状态参数"></a>mlx5计数器和状态参数</h2><p>在sysfs文件系统可以查看<code>/sys/class/infiniband/</code></p><blockquote><ul><li><a href="https://community.mellanox.com/s/article/understanding-mlx5-linux-counters-and-status-parameters" target="_blank" rel="noopener">Understanding mlx5 Linux Counters and Status Parameters</a></li><li><a href="https://mymellanox.force.com/mellanoxcommunity/s/article/infiniband-port-counters" target="_blank" rel="noopener">InfiniBand Port Counters</a></li></ul></blockquote><p>Linux内核说明文档：<a href="https://www.kernel.org/doc/html/latest/admin-guide/abi-stable.html#abi-file-stable-sysfs-class-infiniband" target="_blank" rel="noopener">https://www.kernel.org/doc/html/latest/admin-guide/abi-stable.html#abi-file-stable-sysfs-class-infiniband</a></p><h3 id="counters"><a href="#counters" class="headerlink" title="counters"></a>counters</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ls -lsh /sys/class/infiniband/mlx5_0/ports/1/counters/</span></span><br><span class="line">total 0</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 excessive_buffer_overrun_errors</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 link_downed</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 link_error_recovery</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 local_link_integrity_errors</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 multicast_rcv_packets</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 multicast_xmit_packets</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 port_rcv_constraint_errors</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 port_rcv_data</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 port_rcv_errors</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 port_rcv_packets</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 port_rcv_remote_physical_errors</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 port_rcv_switch_relay_errors</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 port_xmit_constraint_errors</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 port_xmit_data</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 port_xmit_discards</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 port_xmit_packets</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 port_xmit_wait</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 symbol_error</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 unicast_rcv_packets</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 unicast_xmit_packets</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 VL15_dropped</span><br></pre></td></tr></table></figure><p>Counter Description:</p><table><thead><tr><th style="text-align:left"><strong>Counter</strong></th><th style="text-align:left"><strong>Description</strong></th><th style="text-align:left"><strong>InfiniBand Spec Name</strong></th><th style="text-align:left"><strong>Group</strong></th></tr></thead><tbody><tr><td style="text-align:left">port_rcv_data</td><td style="text-align:left">The total number of data octets, divided by 4, (counting in double words, 32 bits), received on all VLs from the port.</td><td style="text-align:left">PortRcvData</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">port_rcv_packets</td><td style="text-align:left">Total number of packets (this may include packets containing Errors. This is 64 bit counter.</td><td style="text-align:left">PortRcvPkts</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">port_multicast_rcv_packets</td><td style="text-align:left">Total number of multicast packets, including multicast packets containing errors.</td><td style="text-align:left">PortMultiCastRcvPkts</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">port_unicast_rcv_packets</td><td style="text-align:left">Total number of unicast packets, including unicast packets containing errors.</td><td style="text-align:left">PortUnicastRcvPkts</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">port_xmit_data</td><td style="text-align:left">The total number of data octets, divided by 4, (counting in double words, 32 bits), transmitted on all VLs from the port.</td><td style="text-align:left">PortXmitData</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">port_xmit_packetsport_xmit_packets_64</td><td style="text-align:left">Total number of packets transmitted on all VLs from this port. This may include packets with errors.This is 64 bit counter.</td><td style="text-align:left">PortXmitPkts</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">port_rcv_switch_relay_errors</td><td style="text-align:left">Total number of packets received on the port that were discarded because they could not be forwarded by the switch relay.</td><td style="text-align:left">PortRcvSwitchRelayErrors</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">port_rcv_errors</td><td style="text-align:left">Total number of packets containing an error that were received on the port.</td><td style="text-align:left">PortRcvErrors</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">port_rcv_constraint_errors</td><td style="text-align:left">Total number of packets received on the switch physical port that are discarded.</td><td style="text-align:left">PortRcvConstraintErrors</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">local_link_integrity_errors</td><td style="text-align:left">The number of times that the count of local physical errors exceeded the threshold specified by LocalPhyErrors.</td><td style="text-align:left">LocalLinkIntegrityErrors</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">port_xmit_wait</td><td style="text-align:left">The number of ticks during which the port had data to transmit but no data was sent during the entire tick (either because of insufficient credits or because of lack of arbitration).</td><td style="text-align:left">PortXmitWait</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">port_multicast_xmit_packets</td><td style="text-align:left">Total number of multicast packets transmitted on all VLs from the port. This may include multicast packets with errors.</td><td style="text-align:left">PortMultiCastXmitPkts</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">port_unicast_xmit_packets</td><td style="text-align:left">Total number of unicast packets transmitted on all VLs from the port. This may include unicast packets with errors.</td><td style="text-align:left">PortUnicastXmitPkts</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">port_xmit_discards</td><td style="text-align:left">Total number of outbound packets discarded by the port because the port is down or congested.</td><td style="text-align:left">PortXmitDiscards</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">port_xmit_constraint_errors</td><td style="text-align:left">Total number of packets not transmitted from the switch physical port.</td><td style="text-align:left">PortXmitConstraintErrors</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">port_rcv_remote_physical_errors</td><td style="text-align:left">Total number of packets marked with the EBP delimiter received on the port.</td><td style="text-align:left">PortRcvRemotePhysicalErrors</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">symbol_error</td><td style="text-align:left">Total number of minor link errors detected on one or more physical lanes.</td><td style="text-align:left">SymbolErrorCounter</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">VL15_dropped</td><td style="text-align:left">Number of incoming VL15 packets dropped due to resource limitations (e.g., lack of buffers) of the port.</td><td style="text-align:left">VL15Dropped</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">link_error_recovery</td><td style="text-align:left">Total number of times the Port Training state machine has successfully completed the link error recovery process.</td><td style="text-align:left">LinkErrorRecoveryCounter</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">link_downed</td><td style="text-align:left">Total number of times the Port Training state machine has failed the link error recovery process and downed the link.</td><td style="text-align:left">LinkDownedCounter</td><td style="text-align:left">Error</td></tr></tbody></table><h3 id="hw-counters"><a href="#hw-counters" class="headerlink" title="hw_counters"></a>hw_counters</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ls -lsh /sys/class/infiniband/mlx5_0/ports/1/hw_counters/</span></span><br><span class="line">total 0</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 duplicate_request</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 implied_nak_seq_err</span><br><span class="line">0 -rw-r--r-- 1 root root 4.0K 5月  28 16:42 lifespan</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 local_ack_timeout_err</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 np_cnp_sent</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 np_ecn_marked_roce_packets</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 out_of_buffer</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 out_of_sequence</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 packet_seq_err</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 req_cqe_error</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 req_cqe_flush_error</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 req_remote_access_errors</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 req_remote_invalid_request</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 resp_cqe_error</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 resp_cqe_flush_error</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 resp_local_length_error</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 resp_remote_access_errors</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 rnr_nak_retry_err</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 rp_cnp_handled</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 rp_cnp_ignored</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 rx_atomic_requests</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 rx_icrc_encapsulated</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 rx_read_requests</span><br><span class="line">0 -r--r--r-- 1 root root 4.0K 5月  24 15:28 rx_write_requests</span><br></pre></td></tr></table></figure><p>HW Counters Description:</p><table><thead><tr><th style="text-align:left"><strong>Counter</strong></th><th style="text-align:left"><strong>Description</strong></th><th style="text-align:left"><strong>Group</strong></th></tr></thead><tbody><tr><td style="text-align:left">duplicate_request</td><td style="text-align:left">Number of received packets. A duplicate request is a request that had been previously executed.</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">implied_nak_seq_err</td><td style="text-align:left">Number of time the requested decided an ACK. with a PSN larger than the expected PSN for an RDMA read or response.</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">lifespan</td><td style="text-align:left">The maximum period in ms which defines the aging of the counter reads. Two consecutive reads within this period might return the same values</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">local_ack_timeout_err</td><td style="text-align:left">The number of times QP’s ack timer expired for RC, XRC, DCT QPs at the sender side.The QP retry limit was not exceed, therefore it is still recoverable error.</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">np_cnp_sent</td><td style="text-align:left">The number of CNP packets sent by the Notification Point when it noticed congestion experienced in the RoCEv2 IP header (ECN bits).The counters was added in MLNX_OFED 4.1</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">np_ecn_marked_roce_packets</td><td style="text-align:left">The number of RoCEv2 packets received by the notification point which were marked for experiencing the congestion (ECN bits where ‘11’ on the ingress RoCE traffic) .The counters was added in MLNX_OFED 4.1</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">out_of_buffer</td><td style="text-align:left">The number of drops occurred due to lack of WQE for the associated QPs.</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">out_of_sequence</td><td style="text-align:left">The number of out of sequence packets received.</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">packet_seq_err</td><td style="text-align:left">The number of received NAK sequence error packets. The QP retry limit was not exceeded.</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">req_cqe_error</td><td style="text-align:left">The number of times requester detected CQEs completed with errors.The counters was added in MLNX_OFED 4.1</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">req_cqe_flush_error</td><td style="text-align:left">The number of times requester detected CQEs completed with flushed errors.The counters was added in MLNX_OFED 4.1</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">req_remote_access_errors</td><td style="text-align:left">The number of times requester detected remote access errors.The counters was added in MLNX_OFED 4.1</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">req_remote_invalid_request</td><td style="text-align:left">The number of times requester detected remote invalid request errors.The counters was added in MLNX_OFED 4.1</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">resp_cqe_error</td><td style="text-align:left">The number of times responder detected CQEs completed with errors.The counters was added in MLNX_OFED 4.1</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">resp_cqe_flush_error</td><td style="text-align:left">The number of times responder detected CQEs completed with flushed errors.The counters was added in MLNX_OFED 4.1</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">resp_local_length_error</td><td style="text-align:left">The number of times responder detected local length errors.The counters was added in MLNX_OFED 4.1</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">resp_remote_access_errors</td><td style="text-align:left">The number of times responder detected remote access errors.The counters was added in MLNX_OFED 4.1</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">rnr_nak_retry_err</td><td style="text-align:left">The number of received RNR NAK packets. The QP retry limit was not exceeded.</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">rp_cnp_handled</td><td style="text-align:left">The number of CNP packets handled by the Reaction Point HCA to throttle the transmission rate.The counters was added in MLNX_OFED 4.1</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">rp_cnp_ignored</td><td style="text-align:left">The number of CNP packets received and ignored by the Reaction Point HCA. This counter should not raise if RoCE Congestion Control was enabled in the network. If this counter raise, verify that ECN was enabled on the adapter. See <a href="https://community.mellanox.com/s/article/howto-configure-dcqcn--roce-cc--values-for-connectx-4--linux-x" target="_blank" rel="noopener">HowTo Configure DCQCN (RoCE CC) values for ConnectX-4 (Linux)</a>.The counters was added in MLNX_OFED 4.1</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">rx_atomic_requests</td><td style="text-align:left">The number of received ATOMIC request for the associated QPs.</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">rx_dct_connect</td><td style="text-align:left">The number of received connection request for the associated DCTs.</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">rx_read_requests</td><td style="text-align:left">The number of received READ requests for the associated QPs.</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">rx_write_requests</td><td style="text-align:left">The number of received WRITE requests for the associated QPs.</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">rx_icrc_encapsulated</td><td style="text-align:left">The number of RoCE packets with ICRC errors.This counter was added in MLNX_OFED 4.4 and kernel 4.19</td><td style="text-align:left">Error</td></tr><tr><td style="text-align:left">roce_adp_retrans</td><td style="text-align:left">Counts the number of adaptive retransmissions for RoCE trafficThe counter was added in MLNX_OFED rev 5.0-1.0.0.0 and kernel v5.6.0</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">roce_adp_retrans_to</td><td style="text-align:left">Counts the number of times RoCE traffic reached timeout due to adaptive retransmissionThe counter was added in MLNX_OFED rev 5.0-1.0.0.0 and kernel v5.6.0</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">roce_slow_restart</td><td style="text-align:left">Counts the number of times RoCE slow restart was usedThe counter was added in MLNX_OFED rev 5.0-1.0.0.0 and kernel v5.6.0</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">roce_slow_restart_cnps</td><td style="text-align:left">Counts the number of times RoCE slow restart generated CNP packetsThe counter was added in MLNX_OFED rev 5.0-1.0.0.0 and kernel v5.6.0</td><td style="text-align:left">Informative</td></tr><tr><td style="text-align:left">roce_slow_restart_trans</td><td style="text-align:left">Counts the number of times RoCE slow restart changed state to slow restartThe counter was added in MLNX_OFED rev 5.0-1.0.0.0 and kernel v5.6.0</td><td style="text-align:left">Informative</td></tr></tbody></table><ul><li><code>duplicate_request</code>:（Duplicated packets）接收报文数，重复请求是先前已执行的请求。</li><li><code>out_of_sequence</code>:（Drop out of sequence）接收到的乱序包的数量，说明此时已经产生了丢包</li><li><code>packet_seq_err</code>：（NAK sequence rcvd）接收到的NAK序列错误数据包的数量，未超过QP重试限制。</li></ul><h2 id="带宽监测工具——netdata"><a href="#带宽监测工具——netdata" class="headerlink" title="带宽监测工具——netdata"></a>带宽监测工具——netdata</h2><p><code>netdata</code>可以查看RDMA网卡的带宽，但是展示的发送和接收的数据是通过<code>/sys/class/infiniband</code>下的节点获取的，因此实际带宽数据是其展示数据的<code>4倍</code></p><p><img src="/images/2021/05/netdata_rdma_ib.png" alt="netdata_rdma_ib"></p><blockquote><p>插件源码：<a href="https://github.com/netdata/netdata/blob/master/collectors/proc.plugin/sys_class_infiniband.c" target="_blank" rel="noopener">https://github.com/netdata/netdata/blob/master/collectors/proc.plugin/sys_class_infiniband.c</a></p></blockquote><h2 id="网卡工作模式"><a href="#网卡工作模式" class="headerlink" title="网卡工作模式"></a>网卡工作模式</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ibstatus</span></span><br><span class="line">Infiniband device 'mlx5_0' port 1 status:</span><br><span class="line">	default gid:	 fe80:0000:0000:0000:0e42:a1ff:fe41:2d36</span><br><span class="line">	base lid:	 0x0</span><br><span class="line">	sm lid:		 0x0</span><br><span class="line">	state:		 4: ACTIVE</span><br><span class="line">	phys state:	 5: LinkUp</span><br><span class="line">	rate:		 25 Gb/sec (1X EDR)</span><br><span class="line">	link_layer:	 Ethernet</span><br><span class="line"></span><br><span class="line">Infiniband device 'mlx5_1' port 1 status:</span><br><span class="line">	default gid:	 fe80:0000:0000:0000:0e42:a1ff:fe41:2d37</span><br><span class="line">	base lid:	 0x0</span><br><span class="line">	sm lid:		 0x0</span><br><span class="line">	state:		 4: ACTIVE</span><br><span class="line">	phys state:	 5: LinkUp</span><br><span class="line">	rate:		 25 Gb/sec (1X EDR)</span><br><span class="line">	link_layer:	 Ethernet</span><br></pre></td></tr></table></figure><ul><li><code>link_layer</code>： 工作模式，Ethernet为IP模式，还有IB（infiniband）模式。</li><li>工作模式切换：<a href="https://community.mellanox.com/s/article/howto-change-port-type-in-mellanox-connectx-3-adapter" target="_blank" rel="noopener">HowTo Change Port Type in Mellanox ConnectX-3 Adapter</a></li></ul><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><ul><li><code>ibstat</code>: 查询InfiniBand设备的基本状态</li><li><code>ibstatus</code>： 网卡信息</li><li><code>ibv_devinfo</code>：网卡设备信息（ibv_devinfo -d mlx5_0 -v）</li><li><code>ibv_devices</code>：查看本主机的infiniband设备</li><li><code>ibnodes</code>：查看网络中的infiniband设备</li><li><code>show_gids</code>：看看网卡支持的roce版本</li><li><code>show_counters</code>:网卡端口统计数据，比如发送接受数据大小</li><li><code>mlxconfig</code>: 网卡配置（mlxconfig -d mlx5_1 q查询网卡配置信息）</li></ul><h2 id="双网口作用"><a href="#双网口作用" class="headerlink" title="双网口作用"></a>双网口作用</h2><p><code>双网口</code>：指一个物理网卡上的两个网络接口</p><ol><li>可以捆绑，比单口效率高多了。同时上两个不同的网络网，有一个不同时，另一个也在同时工作实现网络备份。</li><li>服务器必备2个或2个以上的网口，一个用于网路接入，另一个作为输入。</li><li>家用PC机用2个的网口的网卡，可以实现服务器的初级功能，接入网络然后输入，并管理输入端的网路和数据。</li><li>双口的可以做负载均衡，单口的无此功能。</li><li>双口的可以连接两个网络，可以做网关，单口的直接无法做到此点。当然，如果用两个单口网卡，也可以实现某些双口网卡的同样效果，但在转换速度上还是和双口网卡略有差异。</li></ol><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://blog.csdn.net/xztjhs/article/details/51487467" target="_blank" rel="noopener">infiniband带宽测试方法1 ib_read/write_bw/lat</a></li><li><a href="https://blog.csdn.net/ljlfather/article/details/102925954" target="_blank" rel="noopener">ib_write_bw 和 ib_read_bw 测试 RDMA 的读写处理确定带宽</a></li><li><a href="https://blog.csdn.net/QiangLi_strong/article/details/81021193" target="_blank" rel="noopener">ibverbs文档翻译</a></li><li><a href="https://insujang.github.io/2020-02-09/introduction-to-programming-infiniband/" target="_blank" rel="noopener">Introduction to Programming Infiniband RDMA</a></li><li><a href="https://datatracker.ietf.org/doc/html/draft-talpey-nfsv4-rdma-sess-00" target="_blank" rel="noopener">NFSv4 RDMA and Session Extensions</a></li><li><a href="https://www.mellanox.com/related-docs/prod_software/RDMA_Aware_Programming_user_manual.pdf" target="_blank" rel="noopener">RDMA_Aware_Programming_user_manual.pdf</a></li><li><a href="https://www.cnblogs.com/sctb/p/13179542.html" target="_blank" rel="noopener">infiniband网卡安装、使用总结</a></li><li><a href="https://docs.mellanox.com/display/VMAv883/Port+Type+Management" target="_blank" rel="noopener">Port Type Management</a></li></ul></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/post/53570e5e.html" rel="bookmark">RDMA的底层传输模式</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/post/21135.html" rel="bookmark">网络带宽测试</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/post/33577.html" rel="bookmark">Socket recv —— Connection reset by peer (104)</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/post/28389.html" rel="bookmark">内网穿透——cpolar</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/post/18692.html" rel="bookmark">网络配置</a></div></li></ul><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div><div style="text-align:center;color:#ccc;font-size:16px"><script type="text/javascript" src="https://api.imjad.cn/hitokoto/?cat=&charset=utf-8&length=50&encode=js&fun=sync&source="></script><div id="hitokoto"><script>hitokoto()</script></div></div><div class="reward-container"><div></div> <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';"> 打赏</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="/images/alipay.jpg" alt="Winddoing 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> Winddoing</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://winddoing.github.io/post/f4fa9e36.html" title="RDMA网络简介">https://winddoing.github.io/post/f4fa9e36.html</a></li><li class="post-copyright-statement"> <strong>作者声明：</strong> 本博文为个人笔记, 由于个人能力有限，难免出现错误，欢迎大家批评指正。</li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/网络/" rel="tag"><i class="fa fa-tag"></i> 网络</a><a href="/tags/rdma/" rel="tag"><i class="fa fa-tag"></i> rdma</a></div><div class="post-nav"><div class="post-nav-item"><a href="/post/851846f4.html" rel="prev" title="`GLIBCXX_3.4.21' not found"><i class="fa fa-chevron-left"></i> `GLIBCXX_3.4.21' not found</a></div><div class="post-nav-item"> <a href="/post/c9919005.html" rel="next" title="基于bonding实现网卡聚合">基于bonding实现网卡聚合<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#驱动下载"><span class="nav-number">1.</span> <span class="nav-text">驱动下载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#吞吐量测试"><span class="nav-number">2.</span> <span class="nav-text">吞吐量测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#写吞吐量"><span class="nav-number">2.1.</span> <span class="nav-text">写吞吐量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#读吞吐量"><span class="nav-number">2.2.</span> <span class="nav-text">读吞吐量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#延时测试"><span class="nav-number">3.</span> <span class="nav-text">延时测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#带宽统计"><span class="nav-number">4.</span> <span class="nav-text">带宽统计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网络联通性测试"><span class="nav-number">5.</span> <span class="nav-text">网络联通性测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Server"><span class="nav-number">5.1.</span> <span class="nav-text">Server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Client"><span class="nav-number">5.2.</span> <span class="nav-text">Client</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mlx5计数器和状态参数"><span class="nav-number">6.</span> <span class="nav-text">mlx5计数器和状态参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#counters"><span class="nav-number">6.1.</span> <span class="nav-text">counters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hw-counters"><span class="nav-number">6.2.</span> <span class="nav-text">hw_counters</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#带宽监测工具——netdata"><span class="nav-number">7.</span> <span class="nav-text">带宽监测工具——netdata</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网卡工作模式"><span class="nav-number">8.</span> <span class="nav-text">网卡工作模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常用命令"><span class="nav-number">9.</span> <span class="nav-text">常用命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#双网口作用"><span class="nav-number">10.</span> <span class="nav-text">双网口作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">11.</span> <span class="nav-text">参考</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Winddoing" src="/images/Winddoing.jpg"><p class="site-author-name" itemprop="name">Winddoing</p><div class="site-description" itemprop="description">失败缘于忽视细处，成功始于重视小事。</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">301</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">62</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">245</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/Winddoing" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Winddoing" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://gitee.com/winddoing" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;winddoing" rel="noopener" target="_blank"><i class="fa fa-fw fa-codiepie"></i> Gitee</a></span><span class="links-of-author-item"><a href="mailto:winddoing@sina.cn" title="E-Mail → mailto:winddoing@sina.cn" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://stackoverflow.com/users/9567361/winddoing" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;9567361&#x2F;winddoing" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> StackOverflow</a></span><span class="links-of-author-item"><a href="https://travis-ci.com/Winddoing/Winddoing.github.io" title="Travis CI → https:&#x2F;&#x2F;travis-ci.com&#x2F;Winddoing&#x2F;Winddoing.github.io" rel="noopener" target="_blank"><i class="fa fa-fw fa-terminal"></i> Travis CI</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://winddoing.gitbooks.io/embedded_notes/content/" title="https:&#x2F;&#x2F;winddoing.gitbooks.io&#x2F;embedded_notes&#x2F;content&#x2F;" rel="noopener" target="_blank">嵌入式相关</a></li><li class="links-of-blogroll-item"> <a href="http://blog.csdn.net/sdreamq" title="http:&#x2F;&#x2F;blog.csdn.net&#x2F;sdreamq" rel="noopener" target="_blank">CSDN</a></li><li class="links-of-blogroll-item"> <a href="http://www.wowotech.net/" title="http:&#x2F;&#x2F;www.wowotech.net&#x2F;" rel="noopener" target="_blank">蜗窝科技</a></li><li class="links-of-blogroll-item"> <a href="https://blog.csdn.net/xiongxianze" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;xiongxianze" rel="noopener" target="_blank">xiongxianze</a></li></ul></div><div id="days"></div><script>function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("02/26/2014 15:00:00"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=setzero(Math.floor(e_hrsold)),e_minsold=60*(e_hrsold-hrsold),minsold=setzero(Math.floor(60*(e_hrsold-hrsold))),seconds=setzero(Math.floor(60*(e_minsold-minsold))),document.getElementById("days").innerHTML="已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒"}function setzero(e){return e<10&&(e="0"+e),e}show_date_time()</script><script type="text/javascript" src="//rf.revolvermaps.com/0/0/5.js?i=5bivipiu0pu&amp;m=8&amp;c=ff0000&amp;cr1=ffffff" async="async"></script></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2021</span><span class="with-love" id="heart"><i class="fa fa-heartbeat"></i></span> <span class="author" itemprop="copyrightHolder">Winddoing</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span title="站点总字数">815k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="站点阅读时长">12:21</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.7.0</div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div style="display:inline"><script type="text/javascript">var cnzz_protocol="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cspan id='cnzz_stat_icon_1254703532'%3E%3C/span%3E%3Cscript src='"+cnzz_protocol+"s95.cnzz.com/z_stat.php%3Fid%3D1254703532%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"))</script></div><script>
  function leancloudSelector(url) {
    url = encodeURI(url);
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.getAttribute('id'));
      var title = visitors.getAttribute('data-flag-title');

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              })
          } else {
              Counter('post', '/classes/Counter', { title: title, url: url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.getAttribute('id'));
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (let item of results) {
            let { url, time } = item;
            leancloudSelector(url).innerText = time;
          }
          for (let url of entries) {
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=Q8qpjA3fOO7FEUBqcmcQFptF-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'Q8qpjA3fOO7FEUBqcmcQFptF-gzGzoHsz',
            'X-LC-Key': 'tgUTq5bX3fVmn916EMRe65eJ',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script src="//code.tidio.co/cplpkwr9o7xrystu5jnasyygclahnuoj.js"></script><script>
if (document.querySelectorAll('div.pdf').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/pdfobject@2/pdfobject.min.js', () => {
    document.querySelectorAll('div.pdf').forEach(element => {
      PDFObject.embed(element.getAttribute('target'), element, {
        pdfOpenParams: {
          navpanes: 0,
          toolbar: 0,
          statusbar: 0,
          pagemode: 'thumbs',
          view: 'FitH'
        },
        PDFJS_URL: '/lib/pdf/web/viewer.html',
        height: element.getAttribute('height') || '500px'
      });
    });
  }, window.PDFObject);
}
</script><script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme: 'forest',
      logLevel: 3,
      flowchart: { curve: 'linear' },
      gantt: { axisFormat: '%m/%d/%Y' },
      sequence: { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js"></script><script>pbOptions={iconStyle:"default",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,QQZone,Twitter,Facebook,Evernote"},new needShareButton("#needsharebutton-postbottom",pbOptions)</script></body></html>