---
layout: post
title: ' H264码流格式'
date: '2019-02-20 15:46'
tags:
  - H264
categories:
  - 多媒体
  - 视频
---

H264的两种码流格式，它们分别为：`字节流格式`和`RTP包格式`。

- `字节流格式`: 默认的输出格式。它的基本数据单位为NAL单元，也即NALU。为了从字节流中提取出NALU，协议规定，在每个NALU的前面加上起始码：0x000001或0x00000001（0x代表十六进制）
- RTP包格式: 一种数据传输格式,主要用于网络传送

> 字节流格式,由于它没有经过传输协议封装，所以也可以称之为`裸流`

```
H264比特流 = Start_Code_Prefix + NALU + Start_Code_Prefix + NALU + ...
```

<!--more-->

![H264_struct](/images/2019/02/h264_struct.png)

## 起始码与NALU

> 起始码（Start_Code_Prefix）: `0x00 00 01`或`0x00 00 00 01`

在两个起始码之间的数据，称为`NALU`

## NALU

> NAL Unit: Network Abstract Layer Unit

每个NAL单元包括一个原始字节序列负荷(RBSP, Raw Byte Sequence Payload)、一组对应于视频编码的NAL头信息

```
NALU = NALU Header + RBSP
```

> - `SODB`:(String of Data Bits)最原始的编码数据，无任何附加数据。
> - `RBSP`:在SODB的基础上增加了rbsp_stop_ont_bit(bit值为1)并用0按字节补位对齐。
> - `EBSP`:(Encapsulation Byte Sequence Packets)在RBSP的基础上增加了防止伪起始码字节(0x03)。

### NALU Header

```
NAL Header： forbidden_bit， nal_reference_bit（优先级）， nal_unit_type（类型）
                  1bit            2bit                        5bit
```

## Slice

一个视频图像可编码成一个或更多个条带，每个条带包含整数个宏块（MB），即每个条带至少一个MB，最多时每个条带包含整个图像的宏块。总之，一幅图像中每个条带的宏块数不一定固定。设条带的目的是为了限制误码的扩散和传输，应使编码条带相互间是独立的。某个条带的预测不能以其它条带中的宏块为参考图像，这样某一条带中的预测误差才不会传播到其它条带中去。


## 参考

* [H.264的Slice及Slice类型](https://blog.csdn.net/wh8_2011/article/details/51163368)
