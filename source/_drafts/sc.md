---
abbrlink: 12
---

4000 083c 1300 0000

        <----  0000000  (70Byte, )
              (256Byte)
        <----  0000100
              (256Byte)
        <----  0000200
              (256Byte)
        <----  0000300
              (768Byte)
spl_code <---- 0000600 = 1536Byte = 384word





sckey  size 256world


## msc  spl

```
+----------------+--------+-----------+--------------------------------+
|                |  512B  |   1536B   |                                |     Primary spl
|     GPT(17k)   |  SIG)  |    SC_KEY |             SPL                |
+----------------+--------+-----------+--------------------------------+


                 +--------+------------+-------------------------------+
                 |        |            |                               |     Load TCSM spl
                 |   SIG  |    SC_KEY  |            SPL                |
                 +--------+------------+-------------------------------+

                                       +----+PC
                                       |
                 +--------+--------------------------------------------+
                 |        |            |                               |      Boot SPL
                 |   SIG  |    SC_KEY  |             SPL               |
                 +--------+------------+-------------------------------+

```


## SC_KEY

```
struct spl_struct {                                     
    int len;                                            
    int enc_type;                                       

    int n_bit;                                          
    int ku_bit;                                         
    int rsa_enc_type;                                   
    /* pad to 2048bit.:256Bytes:64words*/               
    int reserved_0[64 - 5];                             

    int key_n[32];                                      
    int reserved_1[64 - 32];                            
    /*pad to 2048bit:256Bytes*/                         
    int key_ku[32];                                     
    /*pad to 2048bit:256Bytes*/                         
    int reserved_2[64 - 32];                            

    int spl_md5_sig_kr_enc[32];                         
    /*pad to 2048bit:256Bytes*/                         

    /*SPL BIN ....*/                                    
};                                                      
```


## nkusig





##  burn nKu

```
  eFuse                                        pc

+-----+       +-------+      +-------+       +------+
|     <-------+  AES  <------+  MD5  <-------+      |
| nKu |       |       |      |       |       | nKu  |
+-----+       +---+---+      +-------+       +------+
                  ^
                  |
+-----+      Read |
| RK  |           |
|     +-----------+
+-----+
```

## check nku

```
 TCSM                   SC_RAM                               eFuse
+--------+             +----------+                        +----------+
|        |             |          |                        |          |
|        |             |          |                        |          |
|        |             |          |                        |          |
+--------+  read       +----------+                        |          |
|  nku   +------------->  NKU     |                        |          |
+--------+      +------+          |             +-----+    +-----+----+
|        |      |      +----------+         +---+ AES <----+ nku | md5|
|        |   +--v--+   |          |         |   |     |    +-----+----+
|        |   | MD5 |   |          |         |   +-----+    |          |
|        |   |     |   |          |         |              |          |
|        |   +--+--+   |          |  +------v------+       |          |
+--------+      |      |          |  |   cmp_data  |       |          |
|MCU_TCSM<------+      |          |  +-^--------+--+       |          |
|NKUSIG  +------+      |          |    |        |          |          |
+--------+      |      +----------+    |        |          +----------+
|        |      +----------------------+        +----------> SC_RETVAL|
+--------+                                                 +----------+

```

check : check_nku

md5 :  md 0xb3422b10
    b3422b10: 698   95b40 5f783fa2 edaf882e 5ea0f9f7


### default

check nku md5:

x2000# md 0xb3422b10
b3422b10: 69cfa45b 18a1eb8d 6c62fba9 da051983

pc:

key md5 0x69cfa45b
key md5 0x18a1eb8d
key md5 0x6c62fba9
key md5 0xda051983

### add nku

check nku md5:

x2000# md 0xb3422b10
b3422b10: 69895b40 5f783fa2 edaf882e 5ea0f9f7

pc:

key md5 0x69895b40
key md5 0x5f783fa2
key md5 0xedaf882e
key md5 0x5ea0f9f7



> DE (decrypt)  解密
> EN (encrypt)  加密

## burn uk

```
    TCSM                     SC+RAM                                 eFuse
                                                                +-------------+
+-----------+            +------------+                         |             |
|           |            |            |                         +-------------+
|           |            |            |               +----+    |  root key   |
|           |            |            |            +--+otpr+----+             |
|           |            |            |            |  +----+    +-------------+
+-----------+   Copy     +------------+       +----v----+       |             |
| MCU_TCSM  +------------>SC_SRAM_DEUK+------->         |       |             |
| PUTUKEY   |            +------------+       |  AES    |       |             |
+-----------+            |            |       |         |       |             |
|           |            |            |       +----+----+       |             |
|           |            +------------+  AES_EN    |            |             |
|           |            | SC_SRAM_UK <------------+  +----+    +-------------+
|           |            |            +---------------+otpw+---->  user key   |
|           |            +------------+               +----+    +-------------+
|           |            |            |                         |             |
|           |            |            |                         |             |
|           |            |            |                         |             |
|           |            |            |                         |             |
+-----------+            +------------+                         +-------------+

```

## aes_by_ukey

### EN

```
   TCSM                             SC+RAM                         eFuse
                                                                +-------------+
+-----------+                    +------------+                 |             |
|           |                    +------------|                 +-------------+
|           |           +--------+ SC_SRAM_RK <-----------------+  root key   |
|           |           |        +------------+  +---------+    +-------------+
|           |           |        |            |  | RW_SCOTP|    |             |
|           |        +--v--+     +------------+  +---------+    +-------------+
|           |        | AES <-----+ SC_SRAM_UK <-----------------+  user key   |
|           |        +-----+     +------------+                 +-------------+
|           |       AES_DE       |            |                 |             |
|           |           +---------------------+                 |             |
+-----------+                    |SC_SRAM_DECK|                 |             |
| MCU_TCSM ^----+       +---------------------+                 |             |
| OUTDATA   | AES_EN    |        |            |                 |             |
+-----------+   +    +--v--+     |            |                 |             |
|           |   +----+ AES <---+ |            |                 |             |
+-----------+        +-----+   | |            |                 |             |
| MCU_TCSM  |       copy       +--------------+                 |             |
| INDATA    +-------------------->SC_SRAM_ARG2|                 |             |
+-----------+                    +------------+                 +-------------+
```


[2017-12-14 10:25:22] x2000# sctest burn_ukey
[2017-12-14 10:25:36] userkey : 0x5eb234ab, 0x7ca34546, 0x1805c32c, 0x0a08f751
[2017-12-14 10:25:36] xxxxxxx data updated: c0000000
[2017-12-14 10:25:36] xxxxxxx state updated: c00003
[2017-12-14 10:25:36] x2000# sctest aes_by_ukey
[2017-12-14 10:25:45] output data 0x0614a2e1,0xe568645f,0xb9f7efa7,0x745c5c40
[2017-12-14 10:25:45] output data 0x7241ec44,0x41196d8d,0xaf30da74,0xad04f282
[2017-12-14 10:25:45] execpt data 0x7241ec44,0x41196d8d,0xaf30da74,0xad04f282


user@ingenic-xxx:~/seckey$ ./aes_c aes userkey
0x7241ec44, 0x41196d8d, 0xaf30da74, 0xad04f282,
RAND_SEED = 7554
0x0614a2e1, 0xe568645f, 0xb9f7efa7, 0x745c5c40,
RAND_SEED = 7554
0x7241ec44, 0x41196d8d, 0xaf30da74, 0xad04f282,


## scboot


1.

```
  TCSM                              eFuse

+-------+     +----+             +----------+
+-------+  +-->AES <-------------+ root key |
|   N   |  |  +-+--+      +-----------------+
+----------+    |         |      | user key |
|  KU   | 1     |         |      +----------+
+-------+       |DE       |      |          |
|       |       |      +--v-+    +----------+
|       |       |    2 | AES<----+   nku    |
|       |       |      +----+    +----------+
|       |       +-+   +---^      |          |
|       |         |   |DE        |          |
|       |      +--v---v---+      |          |
|       |      | cmp_data |      |          |
|       |      +----+-----+      |          |
|       |         3 |            |          |
|       |           |            |          |
|       |           |            |          |
|       |           |            |          |
|       |           |            |          |
+-------+           v            +----------+
```

2.

```
          +------------+    +----------+
         |SPL_KEY_crypt    | By crypt |
         | BY UK / CK |    |  UK / CK |
  TCSM   +--^---+-----+    +-^----+---+         SC+RAM
            |   |            |    |
+-------+  ++---v+    +------+----v-+      +----------------+
| 2048  +--+crypt+----> SPL_BIN_HASH+-+    |                |
+-------+  +-----+    +-------------+ |    |                |
| 2048  |                             |    |                |
+-------+                             |    |                |
|       |                             +--^ +----------------+
|       |    +-----------------------------+SC_SRAM_SPLSHA1 |
|       |    |                             +----------------+
|       |    |                             |                |
|       |    |                             |                |
|       |    |                             |                |
|       |    |        +--------------+     +----------------+
|       |    |    +---+ SPL_HASH_CHECK<----+MCU_TCSM_SPLSHA1ENCBUF
|       |    |    |   +--------------+     +----------------+
|       |    |    |                        |                |
|       |  +-v----v------+                 |                |
|       |  |   cmp_data  |                 |                |
|       |  +-------------+                 +----------------+
|       |         +----------------------->    SC_RETVAL    |
+-------+                                  +----------------+

```


## spl_hash



md5 : b3422b20

    md 0xb3422b20


## mem layout


```
   SC-ROM                                    BOOT-ROM
+---------+                               +----------+
|         |                               |          |
|         |                               |          |
|         |                               |          |
|         |                               |          |
|         |                               |          |
|         |                               |          |
|         |                               |          |
|         |                               |          |
|         |                               |          |
+---------+                               +----------+ <-+
|         |                               |          |   |
|         |                               |          |   |
|   TCSM  |                               |  TCSM    |   |
|         |                               |          |   |bootrom load spl
|         |                               |          |   |
+---------+                               +----------+   |
                                                         |
                                                         |
                                                         +----------------------------------------+
                                                         |            SPL                         |
                                                         |                                        |
                                                         +----------------------------------------+

```


## get ck


```
               +-------------------------------+
   efuse       |        SC_RAM                 |              TCSM
+----------+   |     +-----------+             |          +--------------+
+----------+   |     |           |             |          |              |
| root key +---+     |           |             |          |              |
+----------+         |           |             |          |              |
+----------+  read   +-----------+      +------v--+       +--------------+
| chip key +---------> SC_SRAM_CK+------>  AES    |       |  MCU_TCSM_NKU|
+----------+         +-----------+      |         |  +----+              |
|          |         |           |      +------+--+  |    +--------------+
|          |         |           |             |     |    |              |
|          |         +-----------+             |     |    |              |
|          |         |SC_SRAM_DECK<------------+     |    |              |
|          |         +-----------+---------|    +----+    +--------------+
|          |         |           |      +--v----v--+   +-->TCSM_RSAENCKEY|
|          |         |           |      |   RSA    +---+  +--------------+
|          |         |           |      |          |      |              |
+----------+         +-----------+      +----------+      +--------------+

```


## otp


 EFUSE_REG_STAT 0xb3540008

    md 0xb3540008

efuse

md 0xb3540200



RW   1024bit  32word


[2017-12-13 14:43:45] x2000# sctest cpu_otp_r
[2017-12-13 14:44:02] xxx 4 xxxx data updated: 0x0
[2017-12-13 14:44:02] xxx 3 xxxx data updated: 0x0
[2017-12-13 14:44:02] xxx 2 xxxx data updated: 0x0
[2017-12-13 14:44:02] xxx 1 xxxx data updated: 0x0
[2017-12-13 14:44:02] x2000# sctest cpu_otp_w
[2017-12-13 14:44:08] ===>data: 0x5eb234ab
[2017-12-13 14:44:08] ===>data: 0x7ca34546
[2017-12-13 14:44:08] ===>data: 0x1805c32c
[2017-12-13 14:44:08] ===>data: 0xa08f751
[2017-12-13 14:44:08] x2000# sctest cpu_otp_e
[2017-12-13 14:44:15] cmd err<INTERRUPT>
[2017-12-13 14:44:18] x2000# sctest cpu_otp_r
[2017-12-13 14:44:22] xxx 4 xxxx data updated: 0x5eb234a0
[2017-12-13 14:44:22] xxx 3 xxxx data updated: 0x7ca34544
[2017-12-13 14:44:22] xxx 2 xxxx data updated: 0x1805c32c
[2017-12-13 14:44:22] xxx 1 xxxx data updated: 0xa08f750

start 0 word

[2017-12-13 15:45:37] x2000# sctest cpu_otp_r
[2017-12-13 15:45:40] xxx 2 xxxx data updated: 0x0
[2017-12-13 15:45:40] xxx 1 xxxx data updated: 0x0
[2017-12-13 15:45:40] x2000# sctest cpu_otp_w
[2017-12-13 15:45:44] ===>data: 0x5eb234ab
[2017-12-13 15:45:44] ===>data: 0x7ca34546
[2017-12-13 15:45:44] x2000# sctest cpu_otp_r
[2017-12-13 15:45:48] xxx 2 xxxx data updated: 0x5eb234a8
[2017-12-13 15:45:48] xxx 1 xxxx data updated: 0x7ca34544


start 2 word

[2017-12-13 15:47:31] xxx 2 xxxx data updated: 0x0
[2017-12-13 15:47:31] xxx 1 xxxx data updated: 0x0
[2017-12-13 15:47:31] x2000# sctest cpu_otp_w
[2017-12-13 15:47:34] ===>data: 0x5eb234ab
[2017-12-13 15:47:34] ===>data: 0x7ca34546
[2017-12-13 15:47:34] x2000# sctest cpu_otp_r
[2017-12-13 15:47:39] xxx 2 xxxx data updated: 0x5eb234a0
[2017-12-13 15:47:39] xxx 1 xxxx data updated: 0x7ca34544


        2
[2017-12-13 15:57:01] x2000# sctest cpu_otp_r
[2017-12-13 15:57:12] xxx 2 xxxx data updated: 0x0
[2017-12-13 15:57:12] xxx 1 xxxx data updated: 0x0
[2017-12-13 15:57:12] x2000# sctest cpu_otp_w
[2017-12-13 15:57:18] ===>data: 0x5eb234ab
[2017-12-13 15:57:18] ===>data: 0x7ca34546
[2017-12-13 15:57:18] x2000# sctest cpu_otp_r
[2017-12-13 15:57:23] xxx 2 xxxx data updated: 0x5eb234a8
[2017-12-13 15:57:23] xxx 1 xxxx data updated: 0x7ca34544



/*  0x5eb234ab,0x7ca34546,*/              
/*  0x1805c32c,0x0a08f751,*/              
    0xffffffff,                           
    0xffffffff,                           


[2017-12-13 16:42:27] xxx 8 xxxx data updated: 0x1805c32c
[2017-12-13 16:42:27] xxx 7 xxxx data updated: 0xa08f750
[2017-12-13 16:42:27] xxx 6 xxxx data updated: 0x5eb234a8
[2017-12-13 16:42:27] xxx 5 xxxx data updated: 0x7ca34544
[2017-12-13 16:42:27] xxx 4 xxxx data updated: 0xfffffffc
[2017-12-13 16:42:27] xxx 3 xxxx data updated: 0xfffffffc
[2017-12-13 16:42:27] xxx 2 xxxx data updated: 0xfffffffc
[2017-12-13 16:42:27] xxx 1 xxxx data updated: 0x0



    最后低2bit不能写
