<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="baidu-site-verification" content="WIIeufYjj6"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("https://winddoing.github.io").hostname,root:"/",scheme:"Mist",version:"7.7.0",exturl:!1,sidebar:{position:"right",width:300,display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"flat"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!0,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"输入关键词",hits_empty:"没有找到与「${query}」相关的内容",hits_stats:"${hits} 条相关记录，共耗时 ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="存储器层次结构内存 静态RAM（SRAM）    动态RAM（DRAM）    闪存(flash memory):一类非易失性存储器,基于EEPROM(电子可擦除PROM(Electrically Erasable PROM)) 固件(firmware): 存储在ROM(Read-Only Memory)设备中的程序    I/O桥的作用—翻译 I/O桥将系统总线（system bus）的电子信号"><meta name="keywords" content="Hexo, NexT, Winddoing,嵌入式,Linux,shell,C语言,网络， 个人博客，专注嵌入式系统开发， mips"><meta property="og:type" content="website"><meta property="og:title" content="深入理解计算机系统"><meta property="og:url" content="https://winddoing.github.io/books/深入理解计算机系统/index.html"><meta property="og:site_name" content="Winddoing&#39;s Notes"><meta property="og:description" content="存储器层次结构内存 静态RAM（SRAM）    动态RAM（DRAM）    闪存(flash memory):一类非易失性存储器,基于EEPROM(电子可擦除PROM(Electrically Erasable PROM)) 固件(firmware): 存储在ROM(Read-Only Memory)设备中的程序    I/O桥的作用—翻译 I/O桥将系统总线（system bus）的电子信号"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://winddoing.github.io/books/深入理解计算机系统/images/sram.JPG"><meta property="og:image" content="https://winddoing.github.io/books/深入理解计算机系统/images/dram.JPG"><meta property="og:image" content="https://winddoing.github.io/books/深入理解计算机系统/images/cpu_mem_bus.JPG"><meta property="og:image" content="https://winddoing.github.io/books/深入理解计算机系统/images/cpu_mem_disk.JPG"><meta property="og:image" content="https://winddoing.github.io/books/深入理解计算机系统/images/存储器层次结构.JPG"><meta property="og:image" content="https://winddoing.github.io/books/深入理解计算机系统/images/高速缓存总线架构.JPG"><meta property="og:image" content="https://winddoing.github.io/books/深入理解计算机系统/images/cache_mem_addr_layout.png"><meta property="og:image" content="https://winddoing.github.io/books/深入理解计算机系统/images/cache_layout_struct.png"><meta property="og:image" content="https://winddoing.github.io/books/深入理解计算机系统/images/cache_set_index.JPG"><meta property="og:image" content="https://winddoing.github.io/books/深入理解计算机系统/images/sparc_cpu_core.JPG"><meta property="og:updated_time" content="2021-07-14T09:13:21.865Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="深入理解计算机系统"><meta name="twitter:description" content="存储器层次结构内存 静态RAM（SRAM）    动态RAM（DRAM）    闪存(flash memory):一类非易失性存储器,基于EEPROM(电子可擦除PROM(Electrically Erasable PROM)) 固件(firmware): 存储在ROM(Read-Only Memory)设备中的程序    I/O桥的作用—翻译 I/O桥将系统总线（system bus）的电子信号"><meta name="twitter:image" content="https://winddoing.github.io/books/深入理解计算机系统/images/sram.JPG"><link rel="canonical" href="https://winddoing.github.io/books/深入理解计算机系统/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!1}</script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css"><style>#needsharebutton-postbottom{cursor:pointer;height:26px;margin-top:10px;position:relative}#needsharebutton-postbottom .btn{border:1px solid $btn-default-border-color;border-radius:3px;display:initial;padding:1px 4px}</style><title>深入理解计算机系统 | Winddoing's Notes</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?38fa95924670925239ef842cb0c8722b";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Winddoing's Notes</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Follow Excellent, Success will Chase you</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><div class="post-block" lang="zh-CN"><header class="post-header"><h2 class="post-title" itemprop="name headline">深入理解计算机系统</h2><div class="post-meta"><ul class="breadcrumb"><li><a href="/books/">BOOKS</a></li><li>深入理解计算机系统</li></ul></div></header><div class="post-body"><h1 id="存储器层次结构"><a href="#存储器层次结构" class="headerlink" title="存储器层次结构"></a>存储器层次结构</h1><h2 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h2><ul><li>静态RAM（SRAM）</li></ul><p><img src="images/sram.JPG" alt="SRAM"></p><ul><li>动态RAM（DRAM）</li></ul><p><img src="images/dram.JPG" alt="DRAM"></p><ul><li><code>闪存</code>(flash memory):一类非易失性存储器,基于<code>EEPROM</code>(电子可擦除PROM(Electrically Erasable PROM))</li><li><code>固件</code>(firmware): 存储在ROM(Read-Only Memory)设备中的程序</li></ul><p><img src="images/cpu_mem_bus.JPG" alt="CPU MEM BUS"></p><ul><li>I/O桥的作用—<code>翻译</code><blockquote><p>I/O桥将系统总线（system bus）的电子信号翻译成存储器总线（memory bus）的电子信号</p></blockquote></li></ul><h3 id="示例：读取内存数据"><a href="#示例：读取内存数据" class="headerlink" title="示例：读取内存数据"></a>示例：读取内存数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">movl A %eax</span><br></pre></td></tr></table></figure><blockquote><p>将地址A的内容加载到寄存器%eax中</p></blockquote><ul><li>CPU将地址A放到存储总线上</li><li>主存从总线读取A，取出字x，然后将x放到总线上</li><li>CPU从总线上读出字x，并将其拷贝到寄存器%eax中</li></ul><h2 id="磁盘存储"><a href="#磁盘存储" class="headerlink" title="磁盘存储"></a>磁盘存储</h2><p><img src="images/cpu_mem_disk.JPG" alt="CPU MEM DISK"></p><p>读磁盘操作：</p><ul><li>CPU通过命令、逻辑块号和目的存储器地址写到与磁盘相关的存储器映射地址，发起一个磁盘读操作</li><li>磁盘控制器读扇区，并执行到主存的DMA传送</li><li>当DMA传送完成时，磁盘控制器用<code>中断</code>的方式通知CPU</li></ul><h2 id="局部性"><a href="#局部性" class="headerlink" title="局部性"></a>局部性</h2><blockquote><p><code>局部性原理</code>：编写程序时，倾向于引用邻近于其他最近引用过的数据项的数据项，或者最近引用过的数据项本身。</p></blockquote><p>局部性：时间局部性（temporal locality）和空间局部性（spatial locality）</p><ul><li>时间局部性：被引用过一次的存储位置很可能在不远的将来再被多次引用</li><li>空间局部性：如果一个存储位置被引用一次，那么程序很可能在不远的将来引用附近的一个存储器位置</li></ul><p>局部性原理允许计算机设计者通过引入称为的<code>高速缓存存储器</code>的小而快速的存储器来保存最近被引用的指令和数据项，从而提高对主存的访问速度。</p><h2 id="存储器层次结构-1"><a href="#存储器层次结构-1" class="headerlink" title="存储器层次结构"></a>存储器层次结构</h2><p><img src="images/存储器层次结构.JPG" alt="存储器层次结构"></p><h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>高速缓存（cache）是一个小而快速的存储设备，它作为存储在更大、也更慢的设备中的数据对象的缓冲区域。</p><blockquote><p>缓存（caching）：使用高速缓存的过程</p></blockquote><ul><li>缓存命中（Cache Hit）</li><li>缓存不命中（Cache Miss）<ul><li>覆盖现有缓存的块的过程叫<code>替换</code>（replacing）或<code>驱逐</code>（evicting）</li><li><code>替换策略</code>（replacement policy）: 最近最少被使用（LRU）替换策略的缓存选择那个最后被访问的时间距现在最远的块</li></ul></li></ul><h3 id="缓存管理"><a href="#缓存管理" class="headerlink" title="缓存管理"></a>缓存管理</h3><p>存储器分层结构的本质: <code>每一层存储设备都是较低一层的缓存</code></p><blockquote><ul><li>L1、L2、L3层的缓存完全是由内置在缓存中的硬件逻辑来管理</li><li>DRAM主存作为存储在磁盘上数据块的缓存，是由<code>操作系统</code>软件和<code>CPU上的地址翻译硬件</code>(TLB)共同管理</li></ul></blockquote><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">缓存什么</th><th style="text-align:center">被缓存在何处</th><th style="text-align:center">延迟（周期数）</th><th style="text-align:center">由谁管理</th></tr></thead><tbody><tr><td style="text-align:center">CPU寄存器</td><td style="text-align:center">4字节或8字节字</td><td style="text-align:center">芯片上的CPU寄存器</td><td style="text-align:center">0</td><td style="text-align:center">编译器</td></tr><tr><td style="text-align:center">TLB</td><td style="text-align:center">地址翻译</td><td style="text-align:center">芯片上的TLB</td><td style="text-align:center">0</td><td style="text-align:center">硬件MMU</td></tr><tr><td style="text-align:center">L1高速缓存</td><td style="text-align:center">64字节块</td><td style="text-align:center">芯片上的L1高速缓存</td><td style="text-align:center">1</td><td style="text-align:center">硬件</td></tr><tr><td style="text-align:center">L2高速缓存</td><td style="text-align:center">64字节块</td><td style="text-align:center">芯片上/下的L2高速缓存</td><td style="text-align:center">10</td><td style="text-align:center">硬件</td></tr><tr><td style="text-align:center">L3高速缓存</td><td style="text-align:center">64字节块</td><td style="text-align:center">芯片上/下的L3高速缓存</td><td style="text-align:center">30</td><td style="text-align:center">硬件</td></tr><tr><td style="text-align:center">虚拟存储器</td><td style="text-align:center">4KB</td><td style="text-align:center">主存</td><td style="text-align:center">100</td><td style="text-align:center">硬件+OS</td></tr><tr><td style="text-align:center">缓冲区存储</td><td style="text-align:center">部分文件</td><td style="text-align:center">主存</td><td style="text-align:center">100</td><td style="text-align:center">OS</td></tr><tr><td style="text-align:center">磁盘缓存</td><td style="text-align:center">磁盘扇区</td><td style="text-align:center">磁盘控制器</td><td style="text-align:center">100 000</td><td style="text-align:center">控制器固件</td></tr><tr><td style="text-align:center">网络缓存</td><td style="text-align:center">部分文件</td><td style="text-align:center">本地磁盘</td><td style="text-align:center">10 000 000</td><td style="text-align:center">AFS/NFS客户端</td></tr></tbody></table><blockquote><p>TLB: 翻译后备缓冲器（Translation Lookaside Buffer）</p><ul><li>延迟周期随CPU性能的提高越来越短</li></ul></blockquote><h2 id="高速缓存存储器"><a href="#高速缓存存储器" class="headerlink" title="高速缓存存储器"></a>高速缓存存储器</h2><p><img src="images/高速缓存总线架构.JPG" alt="高速缓存总线架构"></p><h3 id="通用的高速缓存存储器结构"><a href="#通用的高速缓存存储器结构" class="headerlink" title="通用的高速缓存存储器结构"></a>通用的高速缓存存储器结构</h3><p>在CPU中存储器地址线的个数m，将决定其寻址的范围<code>$M=2^m$</code>个不同的地址。</p><p>高速缓存主要是将主存中的数据以一定的方式或者策略映射其中，以提高CPU的读写速度，减少数据访问周期。而映射到在Cache中的数据可以被CPU访问同样是通过地址检索，为了提高CPU检索的速度，将地址进行了划分，分成不同的组（Cache set），每个组分成不同行（Cache line）， 每个行分成不同的数据块（block）来提高访问速度。</p><p>地址划分如下：<br><img src="images/cache_mem_addr_layout.png" alt="Cache内存地址划分"></p><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">位宽</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:center">标记(tag)</td><td style="text-align:center">t</td><td style="text-align:left">用来确定该地址属于哪个高速缓存行（Cache line）</td></tr><tr><td style="text-align:center">组索引(index)</td><td style="text-align:center">s</td><td style="text-align:left">用来确定该地址属于哪个高速缓存组（Cache set）</td></tr><tr><td style="text-align:center">块偏移(offset)</td><td style="text-align:center">b</td><td style="text-align:left">用来确定该地址属于高速缓存行中的哪个数据块（block）</td></tr></tbody></table><blockquote><p>注： m = t + s + b</p></blockquote><p>不同的分类将Cache组织起来，高速缓存（S，E, B, m）的通用组织：<br><img src="images/cache_layout_struct.png" alt="高速缓存通用组织"><br>高速缓存是一个高速缓存组（Cache set）的数组，每一个组包含一个或多个行，每个行包含一个有效位、一些标记位、以及一个数据块</p><blockquote><p>高速缓存的大小：<code>C = S x E x B</code></p></blockquote><h4 id="相关参数"><a href="#相关参数" class="headerlink" title="相关参数"></a>相关参数</h4><table><thead><tr><th style="text-align:center">参数</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:center">$S=2^s$</td><td style="text-align:left">组数</td></tr><tr><td style="text-align:center">$E$</td><td style="text-align:left">每个组行数</td></tr><tr><td style="text-align:center">$B=2^b$</td><td style="text-align:left">块大小（字节）</td></tr><tr><td style="text-align:center">$m=log_2(M)$</td><td style="text-align:left">(主存物理地址位数)</td></tr><tr><td style="text-align:center">$M=2^m$</td><td style="text-align:left">存储器地址最大数量</td></tr><tr><td style="text-align:center">$s=log_2(S)$</td><td style="text-align:left">组索引位数量</td></tr><tr><td style="text-align:center">$b=log_2(B)$</td><td style="text-align:left">块偏移位数量</td></tr><tr><td style="text-align:center">$t=m-(s+b)$</td><td style="text-align:left">标记位数量</td></tr><tr><td style="text-align:center">$C=S\times E\times B$</td><td style="text-align:left">不包含有效位和标记位这样开销的高速缓存大小（字节）</td></tr></tbody></table><h4 id="地址检索流程"><a href="#地址检索流程" class="headerlink" title="地址检索流程"></a>地址检索流程</h4><ol><li>组选择，依据<code>组索引</code></li><li>行匹配，依据<code>标记位</code></li><li>字抽取，依据<code>块偏移</code></li></ol><h4 id="为什么用中间的位做索引？"><a href="#为什么用中间的位做索引？" class="headerlink" title="为什么用中间的位做索引？"></a>为什么用中间的位做索引？</h4><p>如果使用高位做索引，那么一些连续的存储器块就会映射到相同的高速缓存块中<br><img src="images/cache_set_index.JPG" alt="组索引"></p><h3 id="直接映射高速缓存（direct-mapped-cache）"><a href="#直接映射高速缓存（direct-mapped-cache）" class="headerlink" title="直接映射高速缓存（direct-mapped cache）"></a>直接映射高速缓存（direct-mapped cache）</h3><blockquote><p>每一个组中只有一行高速缓存（E=1）</p></blockquote><ul><li>缓存命中（Cache hit）</li><li>缓存不命中（Cache miss）<ul><li>需要从存储器层次结构中的下一层取出被请求的块，然后将新块存储在组索引位指示的组中的一个高速缓存行中。由于直接映射组中只有一个高速缓存行，因此可以直接替换。</li></ul></li></ul><blockquote><p>直接映射高速缓存中容易产生<code>冲突不命中</code>,从而降低高速缓存的性能</p></blockquote><h3 id="组相联高速缓存"><a href="#组相联高速缓存" class="headerlink" title="组相联高速缓存"></a>组相联高速缓存</h3><blockquote><p>每组都保存有多于一个的高速缓存行，一个<code>1&lt;E&lt;C/B</code>的高速缓存通常称为<code>E路高速缓存</code></p></blockquote><ul><li>缓存命中（Cache hit）</li><li>缓存不命中（Cache miss）<ul><li>替换策略：<ul><li>最不常使用(Least-Frequently-Used, LFU)</li><li>最近最少使用(Least-Recently-Used, LRU)</li></ul></li></ul></li></ul><h3 id="全相联高速缓存"><a href="#全相联高速缓存" class="headerlink" title="全相联高速缓存"></a>全相联高速缓存</h3><blockquote><p>由一个包含所有高速缓存行的组（即E=C/B）组成的</p></blockquote><p>因为只有一个组，所以此时就没有组索引位s=</p><h3 id="有关写的问题"><a href="#有关写的问题" class="headerlink" title="有关写的问题"></a>有关写的问题</h3><ul><li>直写(write-through): 就是立即将改动的高速缓存块写回到紧接着的底一层中<ul><li>缺点就是每次写都会引起总线流量</li></ul></li><li>回写(write-back): 尽可能的推迟存储器更新，只有当替换算法要替换更新过的块时，才把他写入紧接着的底一层中。<ul><li>缺点增加复杂度，高速缓存必须为每一个高速缓存行维护一个额外的<code>修改位(dirty bit)</code>，表明这个高速缓存行是否被修改过</li></ul></li></ul><h4 id="写不命中处理"><a href="#写不命中处理" class="headerlink" title="写不命中处理"></a>写不命中处理</h4><ul><li>写分配(write-allocate)：加载相应的底一层中的块到高速缓存中，然后更新这个高速缓存</li><li>非写分配(not-write-allocate)：避开高速缓存，直接把这个字写到底一层中</li></ul><blockquote><p>直写高速缓存通常是非写分配； 回写高速缓存通常是写分配</p></blockquote><h4 id="Write-Store-Buffer"><a href="#Write-Store-Buffer" class="headerlink" title="Write/Store Buffer"></a>Write/Store Buffer</h4><p>现代的处理器往往引入<code>Write/Store Buffer</code>来提升存储系统的性能。Write Buffer的位置位于<code>L1 D-Cache</code>与<code>下一级存储器</code>之间</p><blockquote><p>CPU架构：Open SPARC T1</p></blockquote><p><img src="images/sparc_cpu_core.JPG" alt="SPARC core"></p><p>引入Write Buffer，其优点在于当D-Cache的脏行被替换，数据写回时，此时Cache无需等待可以继续工作，即：其认为数据回写入 Write Buffer即认为此回写操作已完成，无需等待下一级存储器的缓慢响应。Write-through之Cache亦是如此。</p><h3 id="高速缓存参数的性能影响"><a href="#高速缓存参数的性能影响" class="headerlink" title="高速缓存参数的性能影响"></a>高速缓存参数的性能影响</h3><ul><li>不命中率（miss rate）</li><li>命中率（hit rate）</li><li>命中时间（hit time）:从高速缓存传送一个字到CPU所需的时间，包括组选择、行确认和字选择时间</li><li>不命中处罚（miss penalty）</li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://www.oracle.com/technetwork/systems/opensparc/t1-01-opensparct1-micro-arch-1538959.html" target="_blank" rel="noopener">OpenSPARC™T1 Microarchitecture Specification</a></li></ul></div></div><ul class="breadcrumb"><li><a href="/books/">BOOKS</a></li><li>深入理解计算机系统</li></ul></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#存储器层次结构"><span class="nav-number">1.</span> <span class="nav-text">存储器层次结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#内存"><span class="nav-number">1.1.</span> <span class="nav-text">内存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#示例：读取内存数据"><span class="nav-number">1.1.1.</span> <span class="nav-text">示例：读取内存数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#磁盘存储"><span class="nav-number">1.2.</span> <span class="nav-text">磁盘存储</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#局部性"><span class="nav-number">1.3.</span> <span class="nav-text">局部性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储器层次结构-1"><span class="nav-number">1.4.</span> <span class="nav-text">存储器层次结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#缓存"><span class="nav-number">1.4.1.</span> <span class="nav-text">缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缓存管理"><span class="nav-number">1.4.2.</span> <span class="nav-text">缓存管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#高速缓存存储器"><span class="nav-number">1.5.</span> <span class="nav-text">高速缓存存储器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#通用的高速缓存存储器结构"><span class="nav-number">1.5.1.</span> <span class="nav-text">通用的高速缓存存储器结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#相关参数"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">相关参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#地址检索流程"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">地址检索流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#为什么用中间的位做索引？"><span class="nav-number">1.5.1.3.</span> <span class="nav-text">为什么用中间的位做索引？</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#直接映射高速缓存（direct-mapped-cache）"><span class="nav-number">1.5.2.</span> <span class="nav-text">直接映射高速缓存（direct-mapped cache）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组相联高速缓存"><span class="nav-number">1.5.3.</span> <span class="nav-text">组相联高速缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#全相联高速缓存"><span class="nav-number">1.5.4.</span> <span class="nav-text">全相联高速缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#有关写的问题"><span class="nav-number">1.5.5.</span> <span class="nav-text">有关写的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#写不命中处理"><span class="nav-number">1.5.5.1.</span> <span class="nav-text">写不命中处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Write-Store-Buffer"><span class="nav-number">1.5.5.2.</span> <span class="nav-text">Write/Store Buffer</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#高速缓存参数的性能影响"><span class="nav-number">1.5.6.</span> <span class="nav-text">高速缓存参数的性能影响</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">1.6.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Winddoing" src="/images/Winddoing.jpg"><p class="site-author-name" itemprop="name">Winddoing</p><div class="site-description" itemprop="description">失败缘于忽视细处，成功始于重视小事。</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">301</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">62</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">245</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/Winddoing" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Winddoing" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://gitee.com/winddoing" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;winddoing" rel="noopener" target="_blank"><i class="fa fa-fw fa-codiepie"></i> Gitee</a></span><span class="links-of-author-item"><a href="mailto:winddoing@sina.cn" title="E-Mail → mailto:winddoing@sina.cn" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://stackoverflow.com/users/9567361/winddoing" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;9567361&#x2F;winddoing" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> StackOverflow</a></span><span class="links-of-author-item"><a href="https://travis-ci.com/Winddoing/Winddoing.github.io" title="Travis CI → https:&#x2F;&#x2F;travis-ci.com&#x2F;Winddoing&#x2F;Winddoing.github.io" rel="noopener" target="_blank"><i class="fa fa-fw fa-terminal"></i> Travis CI</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://winddoing.gitbooks.io/embedded_notes/content/" title="https:&#x2F;&#x2F;winddoing.gitbooks.io&#x2F;embedded_notes&#x2F;content&#x2F;" rel="noopener" target="_blank">嵌入式相关</a></li><li class="links-of-blogroll-item"> <a href="http://blog.csdn.net/sdreamq" title="http:&#x2F;&#x2F;blog.csdn.net&#x2F;sdreamq" rel="noopener" target="_blank">CSDN</a></li><li class="links-of-blogroll-item"> <a href="http://www.wowotech.net/" title="http:&#x2F;&#x2F;www.wowotech.net&#x2F;" rel="noopener" target="_blank">蜗窝科技</a></li><li class="links-of-blogroll-item"> <a href="https://blog.csdn.net/xiongxianze" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;xiongxianze" rel="noopener" target="_blank">xiongxianze</a></li></ul></div><div id="days"></div><script>function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("02/26/2014 15:00:00"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=setzero(Math.floor(e_hrsold)),e_minsold=60*(e_hrsold-hrsold),minsold=setzero(Math.floor(60*(e_hrsold-hrsold))),seconds=setzero(Math.floor(60*(e_minsold-minsold))),document.getElementById("days").innerHTML="已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒"}function setzero(e){return e<10&&(e="0"+e),e}show_date_time()</script><script type="text/javascript" src="//rf.revolvermaps.com/0/0/5.js?i=5bivipiu0pu&amp;m=8&amp;c=ff0000&amp;cr1=ffffff" async="async"></script></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 – <span itemprop="copyrightYear">2021</span><span class="with-love" id="heart"><i class="fa fa-heartbeat"></i></span> <span class="author" itemprop="copyrightHolder">Winddoing</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span title="站点总字数">815k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="站点阅读时长">12:21</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.7.0</div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div style="display:inline"><script type="text/javascript">var cnzz_protocol="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cspan id='cnzz_stat_icon_1254703532'%3E%3C/span%3E%3Cscript src='"+cnzz_protocol+"s95.cnzz.com/z_stat.php%3Fid%3D1254703532%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"))</script></div><script>
  function leancloudSelector(url) {
    url = encodeURI(url);
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.getAttribute('id'));
      var title = visitors.getAttribute('data-flag-title');

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              })
          } else {
              Counter('post', '/classes/Counter', { title: title, url: url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.getAttribute('id'));
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (let item of results) {
            let { url, time } = item;
            leancloudSelector(url).innerText = time;
          }
          for (let url of entries) {
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=Q8qpjA3fOO7FEUBqcmcQFptF-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'Q8qpjA3fOO7FEUBqcmcQFptF-gzGzoHsz',
            'X-LC-Key': 'tgUTq5bX3fVmn916EMRe65eJ',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script src="//code.tidio.co/cplpkwr9o7xrystu5jnasyygclahnuoj.js"></script><script>
if (document.querySelectorAll('div.pdf').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/pdfobject@2/pdfobject.min.js', () => {
    document.querySelectorAll('div.pdf').forEach(element => {
      PDFObject.embed(element.getAttribute('target'), element, {
        pdfOpenParams: {
          navpanes: 0,
          toolbar: 0,
          statusbar: 0,
          pagemode: 'thumbs',
          view: 'FitH'
        },
        PDFJS_URL: '/lib/pdf/web/viewer.html',
        height: element.getAttribute('height') || '500px'
      });
    });
  }, window.PDFObject);
}
</script><script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme: 'forest',
      logLevel: 3,
      flowchart: { curve: 'linear' },
      gantt: { axisFormat: '%m/%d/%Y' },
      sequence: { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js"></script><script>pbOptions={iconStyle:"default",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,QQZone,Twitter,Facebook,Evernote"},new needShareButton("#needsharebutton-postbottom",pbOptions)</script></body></html>